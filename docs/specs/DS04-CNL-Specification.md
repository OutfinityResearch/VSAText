# DS04 — CNL Specification

## What is CNL?

CNL (Controlled Natural Language) is a human-readable, machine-parseable language for narrative specifications. It uses Subject-Verb-Object syntax that mirrors natural English while being precise enough for automated parsing.

CNL is auto-generated by the visual editor. Authors don't write it directly—they compose visually, and the system generates CNL.

```
Visual Editor → CNL → Parser → AST → Metrics
```

## Core Syntax

### Identifiers

Simple identifiers start with a letter: `Anna`, `Village`, `Chapter1`

Quoted identifiers handle multi-word names: `"The Dark Forest"`, `"inner strength"`

### Statement Types

| Pattern | Meaning | Example |
|---------|---------|---------|
| `X is Y` | Type declaration | `Anna is protagonist` |
| `X has Y Z` | Property | `Anna has trait courage` |
| `X relates to Y as Z` | Relationship | `Anna relates to Marcus as sibling` |
| `X requires "Y"` | Must have | `Story requires "happy ending"` |
| `X forbids "Y"` | Must not have | `Story forbids "violence"` |
| `X must Y Z` | Obligation | `Chapter_1 must introduce Anna` |
| `X owns Y` | Ownership | `Anna owns SilverKey` |
| `X has tone Y` | Tone | `Story has tone hopeful` |
| `X has max Y Z` | Maximum | `Story has max characters 10` |
| `X references @Y` | Cross-reference | `Chapter2 references @Chapter1` |

### Groups

Groups create hierarchical structure (chapters containing scenes containing beats):

```
Chapter1 group begin
  Chapter1 has title "The Beginning"
  
  Scene1 group begin
    Anna discovers artifact
  Scene1 group end
Chapter1 group end
```

### Comments

```
// Single line comment
/* Multi-line comment */
```

## Entity Types

| Type | Examples |
|------|----------|
| Characters | `protagonist`, `antagonist`, `mentor`, `ally` |
| Locations | `location`, `place`, `setting` |
| Moods | `mood` (emotional register for scenes) |
| Props | `artifact`, `object`, `item` |
| Themes | `theme`, `motif` |

## Constraints

Constraints control what must or must not appear in generated content:

```
Story requires "happy ending"     // Must include
Story forbids "explicit violence" // Must exclude
Story has tone hopeful            // Emotional direction
Story has max characters 10       // Numerical limit
Chapter_1 must introduce Anna     // Specific obligation
```

## Pattern System

Patterns are reusable templates with variable slots:

```
"Hero's Call" is pattern
"Hero's Call" has variable $hero as character
"Hero's Call" has variable $location as location

"Hero's Call" has template begin
  $hero is at $location
  $hero discovers "call to adventure"
"Hero's Call" has template end
```

Instantiate by binding variables to entities:

```
Scene1 uses pattern "Hero's Call"
  $hero binds to Anna
  $location binds to Village
Scene1 pattern end
```

## Example

```
// Characters
Anna is protagonist
Anna has trait courage
Anna relates to Marcus as sibling

// Locations  
Village is location
Village has atmosphere peaceful

// Constraints
Story requires "happy ending"
Story forbids "violence"
Story has tone hopeful

// Structure
Book group begin
  Chapter1 group begin
    Anna is at Village
    Anna discovers storm
  Chapter1 group end
Book group end
```

## Parsing Output

The parser produces an AST with:
- `entities` - all declared entities with properties
- `groups` - hierarchical structure
- `constraints` - requires/forbids/must/tone/max/min
- `relationships` - entity connections
- `ownership` - who owns what
- `references` - cross-references between groups

Metrics are calculated by interpreting this AST against generated content.
