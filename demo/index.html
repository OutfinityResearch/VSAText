<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SCRIPTA - Visual Story Composer</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app">
    <header>
      <div class="logo"><h1>SCRIPTA</h1></div>
      <div class="header-center">
        <input type="text" class="project-name" id="project-name" value="Untitled Story">
      </div>
      <div class="header-actions">
        <button class="btn" id="btn-load" title="Load project from server">Load</button>
        <button class="btn accent" id="btn-save" title="Save project to server">Save</button>
        <button class="btn" id="btn-new">New</button>
        <button class="btn success" id="btn-export">Export CNL</button>
        <button class="btn primary" id="btn-evaluate">Evaluate</button>
      </div>
    </header>

    <aside class="tree-panel">
      <div class="panel-header" style="flex-direction: column; gap: 0.5rem; padding: 0.8rem;">
        <button class="btn random" id="btn-generate" style="width: 100%; font-size: 0.7rem; padding: 0.6rem;">Generate Story</button>
        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
          <span class="panel-title">Structure</span>
          <button class="tree-add" id="btn-add-root" title="Add Book">+</button>
        </div>
      </div>
      <div class="tree-container" id="tree-container"></div>
    </aside>

    <main class="center-panel">
      <div class="tabs">
        <button class="tab active" data-view="cnl">CNL</button>
        <button class="tab" data-view="characters">Characters</button>
        <button class="tab" data-view="relationships">Relations</button>
        <button class="tab" data-view="locations">Locations</button>
        <button class="tab" data-view="objects">Objects</button>
        <button class="tab" data-view="moods">Moods</button>
        <button class="tab" data-view="emotionalarc">Arc</button>
        <button class="tab" data-view="blocks">Blocks</button>
        <button class="tab" data-view="worldrules">World</button>
        <button class="tab" data-view="themes">Themes</button>
      </div>
      <div class="tab-content">
        <div class="view active" id="view-cnl">
          <div class="cnl-output" id="cnl-output">// CNL auto-generated from visual structure</div>
        </div>
        <div class="view" id="view-characters"><div class="entity-grid" id="characters-grid"></div></div>
        <div class="view" id="view-relationships"><div class="relationships-view" id="relationships-view"></div></div>
        <div class="view" id="view-locations"><div class="entity-grid" id="locations-grid"></div></div>
        <div class="view" id="view-objects"><div class="entity-grid" id="objects-grid"></div></div>
        <div class="view" id="view-moods"><div class="entity-grid" id="moods-grid"></div></div>
        <div class="view" id="view-emotionalarc"><div class="emotional-arc-view" id="emotionalarc-view"></div></div>
        <div class="view" id="view-blocks"><div class="blocks-view" id="blocks-view"></div></div>
        <div class="view" id="view-worldrules"><div class="rules-grid" id="worldrules-grid"></div></div>
        <div class="view" id="view-themes"><div class="entity-grid" id="themes-grid"></div></div>
      </div>
    </main>

    <aside class="metrics-panel">
      <div class="panel-header"><span class="panel-title">Metrics</span></div>
      <div class="metrics-content" id="metrics-content"></div>
    </aside>

    <footer>
      <div class="footer-stats">
        <span>Chars: <span class="stat-value" id="stat-chars">0</span></span>
        <span>Locs: <span class="stat-value" id="stat-locs">0</span></span>
        <span>Scenes: <span class="stat-value" id="stat-scenes">0</span></span>
        <span>Rules: <span class="stat-value" id="stat-rules">0</span></span>
      </div>
      <span>SCRIPTA v3.2</span>
    </footer>
  </div>

  <!-- Context Menu -->
  <div class="context-menu" id="context-menu"></div>
  
  <!-- Entity Modal -->
  <div class="modal-overlay" id="entity-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="modal-title">Add Entity</h2>
        <button class="modal-close" onclick="closeModal('entity-modal')">x</button>
      </div>
      <div class="modal-body" id="modal-body"></div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal('entity-modal')">Cancel</button>
        <button class="btn primary" id="btn-modal-save">Save</button>
      </div>
    </div>
  </div>

  <!-- Select Modal -->
  <div class="modal-overlay" id="select-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="select-modal-title">Select</h2>
        <button class="modal-close" onclick="closeModal('select-modal')">x</button>
      </div>
      <div class="modal-body" id="select-modal-body"></div>
    </div>
  </div>

  <!-- Load Modal -->
  <div class="modal-overlay" id="load-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Load Project</h2>
        <button class="modal-close" onclick="closeModal('load-modal')">x</button>
      </div>
      <div class="modal-body" id="load-modal-body">
        <div class="empty-state"><div class="empty-state-text">Loading...</div></div>
      </div>
    </div>
  </div>

  <!-- Generate Modal -->
  <div class="modal-overlay" id="generate-modal">
    <div class="modal wide">
      <div class="modal-header">
        <h2 class="modal-title">Generate Story</h2>
        <button class="modal-close" onclick="closeModal('generate-modal')">x</button>
      </div>
      <div class="modal-body" id="generate-modal-body">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
          <div>
            <div class="form-group">
              <label class="form-label">Genre</label>
              <select class="form-select" id="gen-genre">
                <option value="fantasy">Fantasy</option>
                <option value="scifi">Science Fiction</option>
                <option value="mystery">Mystery / Thriller</option>
                <option value="romance">Romance</option>
                <option value="horror">Horror</option>
                <option value="adventure">Adventure</option>
                <option value="drama">Drama</option>
                <option value="comedy">Comedy</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Story Length</label>
              <select class="form-select" id="gen-length">
                <option value="short">Short (3-5 scenes)</option>
                <option value="medium" selected>Medium (8-12 scenes)</option>
                <option value="long">Long (15-20 scenes)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Number of Characters</label>
              <select class="form-select" id="gen-chars">
                <option value="few">Few (2-3)</option>
                <option value="medium" selected>Medium (4-6)</option>
                <option value="many">Many (7-10)</option>
              </select>
            </div>
          </div>
          <div>
            <div class="form-group">
              <label class="form-label">Tone</label>
              <select class="form-select" id="gen-tone">
                <option value="dark">Dark / Serious</option>
                <option value="balanced" selected>Balanced</option>
                <option value="light">Light / Hopeful</option>
                <option value="comedic">Comedic</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Complexity</label>
              <select class="form-select" id="gen-complexity">
                <option value="simple">Simple (linear plot)</option>
                <option value="moderate" selected>Moderate (some twists)</option>
                <option value="complex">Complex (multiple threads)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">World Rules</label>
              <select class="form-select" id="gen-rules">
                <option value="none">None (realistic)</option>
                <option value="few" selected>Few special rules</option>
                <option value="many">Rich world-building</option>
              </select>
            </div>
          </div>
        </div>
        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--bg-elevated);">
          <div class="form-group">
            <label class="form-label">Quick Templates</label>
            <div style="display: flex; flex-wrap: wrap; gap: 0.4rem;">
              <button class="btn small" onclick="applyTemplate('classic_hero')">Classic Hero Quest</button>
              <button class="btn small" onclick="applyTemplate('mystery')">Murder Mystery</button>
              <button class="btn small" onclick="applyTemplate('romance')">Romance Drama</button>
              <button class="btn small" onclick="applyTemplate('scifi')">Space Adventure</button>
              <button class="btn small" onclick="applyTemplate('horror')">Horror Survival</button>
              <button class="btn small" onclick="applyTemplate('minimal')">Minimal (Empty)</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal('generate-modal')">Cancel</button>
        <button class="btn primary" onclick="executeGenerate()">Generate</button>
      </div>
    </div>
  </div>

  <script type="module" src="app/main.mjs"></script>
</body>
</html>
